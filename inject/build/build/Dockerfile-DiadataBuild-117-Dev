FROM public.ecr.aws/docker/library/golang:1.17 as build

RUN apt update && apt upgrade -y

COPY ./config/ /config/
COPY --link . /diadata

WORKDIR $GOPATH/src/
ENV GO111MODULE="on"
COPY ./go.mod ./
RUN go mod edit -replace github.com/diadata-org/diadata=/diadata
RUN go mod download

RUN go get github.com/karalabe/usb@v0.0.0-20210518091819-4ea20957c210